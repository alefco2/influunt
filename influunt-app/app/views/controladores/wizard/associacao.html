<fieldset data-ng-init="inicializaAssociacao()">
  <div class="row">
    <uib-alert type="danger" close="closeAlert(currentAnelIndex, 'all')" data-ng-if="errors.general || errors.aneis[currentAnelIndex].checkQuantidadeGruposSemaforicosDePedestre || errors.aneis[currentAnelIndex].checkQuantidadeGruposSemaforicosVeiculares">
      <div style="padding-left: 12px;">
        <ul>
          <li data-ng-repeat="message in errors.general">{{ message }}</li>
          <li data-ng-repeat="message in errors.aneis[currentAnelIndex].checkQuantidadeGruposSemaforicosDePedestre">{{ message }}</li>
          <li data-ng-repeat="message in errors.aneis[currentAnelIndex].checkQuantidadeGruposSemaforicosVeiculares">{{ message }}</li>
        </ul>
      </div>
    </uib-alert>

    <div class="text-center m-t-md pd-lf-rt">
      <div class="col-lg-2 col-sm-2 no-padding">
        <div class="col-lg-12 col-sm-12 association">
          <ng-include src="'views/controladores/wizard/common/seleciona-aneis.html'"></ng-include>
        </div>
      </div>
      <div class="col-lg-7 col-sm-7 stages">
        <nav>
          <ul class="handle">
            <li class="ibox" data-ng-repeat="(indexEstagio, estagio) in currentAnel.estagios"
                data-ng-click="selecionaEstagio(indexEstagio)">
              <div class="title-stages" data-ng-class="{'estagio-selecionado': indexEstagio === currentEstagioId}">
                <hgroup>
                  <span class="badge badge-danger badge-notification"
                    data-ng-show="estagioTemErro(currentAnelIndex, indexEstagio)"
                    inf-tooltip
                    messages="errors.aneis[currentAnelIndex].estagios[currentEstagioId]">
                    <i class="fa fa-exclamation"></i>
                  </span>
                  <p>E{{ $index + 1 }}</p>
                </hgroup>
              </div>
              <div class="stage-stages">
                <div class="exist-figure">
                  <figure>
                    <img ng-src="{{ estagio.imagem.id | imageSource }}" style="width: 155px;">
                  </figure>
                </div>
              </div>
              <div class="times-stages">
                <div class="col-lg-7 col-sm-7 left no-padding">
                  <div class="col-lg-5 col-sm-5">
                    <label class="control-label no-padding">Desativação de tempo máximo</label>
                  </div>
                  <div class="col-lg-7 col-sm-7 no-padding">
                    <div class="input-group m-b">
                      <span class="input-group-addon padding-5">
                        <input type="checkbox" ichecks data-ng-model="estagio.tempoMaximoPermanenciaAtivo"
                          if-unchecked="limpaTempoPermanencia(estagio)">
                      </span>
                      <input type="number" ng-model="estagio.tempoMaximoPermanencia"
                        data-ng-disabled="!estagio.tempoMaximoPermanenciaAtivo" class="form-control">
                      <span class="input-group-addon" style="padding: 6px;">seg.</span>
                    </div>
                  </div>
                </div>
                <div class="col-md-offset-1 col-lg-4 col-sm-4 right">
                  <label class="checkbox-inline i-checks right demanda-prioritaria">
                    Demanda prioritária
                    <input type="checkbox" ichecks data-ng-model="estagio.demandaPrioritaria">
                  </label>
                </div>
                <div class="clearfix"></div>
                <div class="col-lg-12 col-sm-12 form-group group-selectons no-padding">
                  <label class="checkbox-inline i-checks" data-ng-repeat="(indexGrupo, grupo) in currentAnel.gruposSemaforicos">
                    <p>{{ grupo.label }}</p>
                    <input type="checkbox" ichecks data-ng-model="grupo.estagiosRelacionados[estagio.id]" i-changed="associaEstagiosGrupoSemaforico(grupo, estagio)">
                  </label>
                </div>
              </div>
            </li>
          </ul>
        </nav>
      </div>
      <div class="col-lg-3 col-sm-3 deactivation bg-border" ng-class="{'hide': gruposSelecionados.length==0 }">
        <form method="get" class="form-horizontal">
          <nav role="navigation">
            <ul>
              <li data-ng-repeat="grupoSelecionado in gruposSelecionados">
                <hgroup>
                  <label class="checkbox-inline i-checks">
                    <p class="label-name">{{ grupoSelecionado.label }}</p>
                    <!-- <input type="checkbox" ichecks i-changed="toggleEstagioAtivado(grupoSelecionado, currentEstagio)"
                      data-ng-model="grupoSelecionado.estagiosAtivados[currentEstagio.id]"> -->
                  </label>
                  <!-- <p class="label-status">Ativado</p> -->
                </hgroup>
                <div class="form-group select right">
                  <div class="col-lg-12 col-sm-12">

                    <select class="form-control m-b" data-ng-model="grupoSelecionado.tipo" name="tipoGrupoSemaforico">
                      <option></option>
                      <option value="VEICULAR">Veicular</option>
                      <option value="PEDESTRE">Pedestre</option>
                    </select>

                  </div>
                </div>
                <div class="form-group input">
                  <div class="ol-lg-12 col-sm-12">
                    <input type="text" class="form-control" placeholder="Comentário" data-ng-model="grupoSelecionado.descricao">
                  </div>
                </div>
              </li>
            </ul>
          </nav>
        </form>
    </div>
    <div class="col-sm-12 col-lg-12 no-pading bg-border pg-bt m-t-lg">
      <a data-ng-click="submitForm({$valid: true}, 'associacao_grupos_semaforicos', 'app.wizard_controladores.aneis')" class="btn btn-default left m-r-sm">{{ 'plugins.steps.labels.previous' | translate }}</a>
      <a data-ng-click="submitForm({$valid: true}, 'associacao_grupos_semaforicos', 'app.wizard_controladores.verdes_conflitantes')" class="btn btn-primary left">{{ 'plugins.steps.labels.next' | translate }}</a>
    </div>
    </div>
  </div>
</fieldset>
<!-- {{ objeto }} -->

<script>
  $(document).ready(function(){

    WinMove();

    function WinMove() {
      var element = ".handle";
      var handle = ".title-stages";
      var connect = ".handle";
      $(element).sortable(
      {
        handle: handle,
        connectWith: connect,
        tolerance: 'pointer',
        forcePlaceholderSize: true,
        opacity: 0.8
      })
      .disableSelection();
    };


    function readURL() {
      var $input = $(this);
      if (this.files && this.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
          $input.next('.attrImg').attr('src', e.target.result).show();
        }
        reader.readAsDataURL(this.files[0]);
      }
    }

    $(".imgInp").change(readURL);
    $(".imgInp").change(function(){
      $(this).parents().eq(3).addClass('change');
    });

    // $('.i-checks').iCheck({
    //     checkboxClass: 'icheckbox_square-green',
    //     radioClass: 'iradio_square-green',
    // });
  });
</script>
