<fieldset data-ng-init="inicializaAssociacao()">
  <div class="row">
    <div class="text-center">
      <div class="col-lg-2 col-sm-2">
        <div class="col-lg-12 col-sm-12 association">
          <nav>
            <ul>
              <li data-ng-repeat="anel in aneis"
                 data-ng-click="selecionaAnel($index)"
                 data-ng-class="{'anel-selecionado': $index === currentAnelId}" class="row">
                  <label>Anel {{ anel.posicao }}</label>
              </li>
            </ul>
          </nav>
        </div>
      </div>
      <div class="col-lg-7 col-sm-7 stages">
        <nav>
          <ul class="handle">
            <li class="ibox" data-ng-repeat="(indexMovimento, movimento) in currentAnel.movimentos"
                data-ng-click="selecionaMovimento(indexMovimento)">
              <div class="title-stages" data-ng-class="{'movimento-selecionado': indexMovimento === currentMovimentoId}">
                <hgroup>
                  <p>E{{ $index + 1 }}</p>
                </hgroup>
              </div>
              <div class="stage-stages">
                <div class="exist-figure">
                  <figure>
                    <img ng-src="{{ movimento.imagem.id | imageSource }}">
                  </figure>
                </div>
                <div class="upload-figure">
                  <!-- <figure data-ng-style="{ background: url({{ movimento.estagio.imagem.id | imageSource  }}) }"> -->
                  <figure custom-background="movimento.estagio.imagem.id | imageSource">
                    <form class="dropzone" enctype="multipart/form-data"
                        influunt-dropzone anel="currentAnel"
                        on-success="relacionaImagemAoEstagio(movimento, upload, imagem)"
                        style="min-height: 135px; max-height: 135px; padding: 0;">
                      <div>
                        <!-- <img data-ng-if="movimento.estagio.imagem" data-ng-src="{{ movimento.estagio.imagem.id | imageSource  }}"> -->
                        <hgroup data-ng-if="!movimento.estagio.imagem">
                          <i class="fa fa-upload" aria-hidden="true"></i>
                          <label title="Adicione um estágio a este movimento" for="anel-1" class="">
                            Adicione um Estágioa este Movimento
                            <img class="attrImg" src="#" alt="" width="250" />
                          </label>
                        </hgroup>
                      </div>
                      <div class="fallback">
                        <input name="file" type="file" multiple />
                      </div>
                    </form>
                  </figure>
                </div>
              </div>
              <div class="times-stages">
                <div class="col-lg-6 col-sm-6 no-padding left">
                  <div class="col-lg-6 col-sm-6">
                    <label class="control-label no-padding">Tempo max. de permanência</label>
                  </div>
                  <div class="col-lg-6 col-sm-6 no-padding">
                    <input type="number" ng-model="movimento.estagio.tempoMaximoPermanencia" class="form-control">
                  </div>
                </div>
                <div class="col-lg-6 col-sm-6 no-padding left">
                  <label class="checkbox-inline i-checks right">
                    <div class="col-lg-10 col-sm-10 left">Demanda prioritária</div>
                    <input type="checkbox" ichecks data-ng-model="movimento.estagio.demandaPrioritaria">
                  </label>
                </div>
                <div class="clearfix"></div>
                <div class="col-lg-12 col-sm-12 form-group group-selectons no-padding">
                  <label class="checkbox-inline i-checks" data-ng-repeat="(indexGrupo, grupo) in currentAnel.gruposSemaforicos">
                    <p>{{ grupo.label }}</p>
                    <input type="checkbox" ichecks data-ng-model="grupo.estagiosRelacionados[movimento.estagio.id]" i-changed="associaEstagiosGrupoSemaforico(grupo, movimento)">
                  </label>
                </div>
              </div>
            </li>
          </ul>
        </nav>
      </div>
      <div class="col-lg-3 col-sm-3 deactivation">
        <form method="get" class="form-horizontal">
          <nav role="navigation">
            <ul>
              <li data-ng-repeat="grupoSelecionado in gruposSelecionados">
                <hgroup>
                  <label class="checkbox-inline i-checks">
                    <p class="label-name">{{ grupoSelecionado.label }}</p>
                    <input type="checkbox" ichecks i-changed="toggleEstagioAtivado(grupoSelecionado, currentMovimento)" data-ng-model="grupoSelecionado.estagiosAtivados[currentMovimento.estagio.id]">
                  </label>
                  <p class="label-status">Ativado</p>
                </hgroup>
                <div class="form-group select right">
                  <div class="col-lg-12 col-sm-12">

                    <select class="form-control m-b" data-ng-model="grupoSelecionado.tipo">
                      <option></option>
                      <option value="VEICULAR">Veicular</option>
                      <option value="PEDESTRE">Pedestre</option>
                    </select>

                  </div>
                </div>
                <div class="form-group input">
                  <div class="ol-lg-12 col-sm-12">
                    <input type="text" class="form-control" placeholder="Comentário"
                      data-ng-model="grupoSelecionado.descricao">
                  </div>
                </div>
              </li>
            </ul>
          </nav>
        </form>
    </div>
    </div>
  </div>
  <div class="col-sm-12 col-lg-12 m-b-lg">
    <a data-ng-click="submitForm({$valid: true}, 'associacao_grupos_semaforicos', 'app.wizard_contrladores.aneis')" class="btn btn-default">{{ 'plugins.steps.labels.previous' | translate }}</a>
    <a data-ng-click="submitForm({$valid: true}, 'associacao_grupos_semaforicos', 'app.wizard_contrladores.verdes_conflitantes')" class="btn btn-primary">{{ 'plugins.steps.labels.next' | translate }}</a>
    <!-- <a ui-sref="app.wizard_contrladores.dados-basicos" class="btn btn-default">{{ 'plugins.steps.labels.previous' | translate }}</a>
    <a ui-sref="app.wizard_contrladores.verdes-conflitantes" class="btn btn-primary">{{ 'plugins.steps.labels.next' | translate }}</a> -->
  </div>
</fieldset>
<!-- {{ objeto }} -->

<script>
  $(document).ready(function(){

    WinMove();

    function WinMove() {
      var element = ".handle";
      var handle = ".title-stages";
      var connect = ".handle";
      $(element).sortable(
      {
        handle: handle,
        connectWith: connect,
        tolerance: 'pointer',
        forcePlaceholderSize: true,
        opacity: 0.8
      })
      .disableSelection();
    };


    function readURL() {
      var $input = $(this);
      if (this.files && this.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
          $input.next('.attrImg').attr('src', e.target.result).show();
        }
        reader.readAsDataURL(this.files[0]);
      }
    }

    $(".imgInp").change(readURL);
    $(".imgInp").change(function(){
      $(this).parents().eq(3).addClass('change');
    });

    // $('.i-checks').iCheck({
    //     checkboxClass: 'icheckbox_square-green',
    //     radioClass: 'iradio_square-green',
    // });
  });
</script>
